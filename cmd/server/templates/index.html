<!DOCTYPE html>
<html>
<head>
    <title>Compliance Dashboard</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            font-size: 15px; 
            line-height: 1.5;
            margin: 20px;
            padding: 0; 
            color: #000;
            background: white;
            max-width: 1000px;
        }
        
        h1 { 
            font-size: 24px; 
            font-weight: 600;
            margin: 0 0 20px 0; 
            color: #000;
        }
        
        .stats {
            margin: 20px 0;
            padding: 15px 0;
            border-bottom: 1px solid #ddd;
            color: #666;
        }
        
        .stat {
            display: inline-block;
            margin-right: 30px;
        }
        
        .stat-value {
            font-weight: 600;
            color: #000;
        }
        
        .filters {
            margin: 20px 0;
        }
        
        .filters a {
            color: #0066cc;
            text-decoration: none;
            margin-right: 15px;
        }
        
        .filters a:hover {
            text-decoration: underline;
        }
        
        .filters .active {
            font-weight: 600;
            color: #000;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th {
            text-align: left;
            padding: 10px 5px;
            border-bottom: 2px solid #000;
            font-weight: 600;
        }
        
        td {
            padding: 10px 5px;
            border-bottom: 1px solid #eee;
        }
        
        tr:hover {
            background: #f9f9f9;
        }
        
        a {
            color: #0066cc;
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
        
        .status-excellent {
            color: #0A7C0A;
            font-weight: 600;
        }
        
        .status-good {
            color: #0066CC;
            font-weight: 600;
        }
        
        .status-poor {
            color: #CC0000;
            font-weight: 600;
        }
        
        .status-checking {
            color: #999;
        }
        
        .pagination {
            margin: 30px 0;
            padding: 15px 0;
            border-top: 1px solid #ddd;
            color: #666;
        }
        
        .pagination a {
            margin: 0 10px;
        }
        
        .empty {
            padding: 40px;
            text-align: center;
            color: #666;
        }
        
        .search-box {
            margin: 20px 0;
        }
        
        .search-box input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 300px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>Compliance Dashboard</h1>
    
    <div class="stats">
        <span class="stat">
            Total: <span class="stat-value">{{.Total}}</span>
        </span>
        {{if .Devices}}
        {{$excellentCount := 0}}
        {{$goodCount := 0}}
        {{$poorCount := 0}}
        {{$checkingCount := 0}}
        {{range .Devices}}
            {{if .ComplianceScore}}
                {{if ge .ComplianceScore 0.9}}
                    {{$excellentCount = add $excellentCount 1}}
                {{else if ge .ComplianceScore 0.7}}
                    {{$goodCount = add $goodCount 1}}
                {{else}}
                    {{$poorCount = add $poorCount 1}}
                {{end}}
            {{else}}
                {{$checkingCount = add $checkingCount 1}}
            {{end}}
        {{end}}
        {{if gt $excellentCount 0}}
        <span class="stat">
            Excellent: <span class="stat-value status-excellent">{{$excellentCount}}</span>
        </span>
        {{end}}
        {{if gt $goodCount 0}}
        <span class="stat">
            Good: <span class="stat-value status-good">{{$goodCount}}</span>
        </span>
        {{end}}
        {{if gt $poorCount 0}}
        <span class="stat">
            Issues: <span class="stat-value status-poor">{{$poorCount}}</span>
        </span>
        {{end}}
        {{if gt $checkingCount 0}}
        <span class="stat">
            Pending: <span class="stat-value status-checking">{{$checkingCount}}</span>
        </span>
        {{end}}
        {{end}}
    </div>
    
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="Search by hostname or user..." value="{{.Search}}">
        {{if .Search}}<a href="?" style="margin-left: 10px;">Clear</a>{{end}}
    </div>
    
    <div class="filters">
        <a href="?" class="{{if not .Status}}active{{end}}">All</a>
        <a href="?status=excellent" class="{{if eq .Status "excellent"}}active{{end}}">Excellent</a>
        <a href="?status=good" class="{{if eq .Status "good"}}active{{end}}">Good</a>
        <a href="?status=issues" class="{{if eq .Status "issues"}}active{{end}}">Has Issues</a>
        <a href="?status=checking" class="{{if eq .Status "checking"}}active{{end}}">Checking</a>
    </div>
    
    {{if .Devices}}
    <table>
        <thead>
            <tr>
                <th>Hostname</th>
                <th>User</th>
                <th>OS</th>
                <th>Compliance</th>
                <th>Last Update</th>
            </tr>
        </thead>
        <tbody>
            {{range .Devices}}
            <tr>
                <td><a href="/device/{{.HardwareID}}">{{.Hostname}}</a></td>
                <td>{{.User}}</td>
                <td>{{.OS}} {{.Version}}</td>
                <td>
                    {{if .ComplianceScore}}
                        <span class="{{if ge .ComplianceScore 0.9}}status-excellent{{else if ge .ComplianceScore 0.7}}status-good{{else}}status-poor{{end}}">
                            {{printf "%.0f" (mulf .ComplianceScore 100.0)}}%
                        </span>
                    {{else}}
                        <span class="status-checking">—</span>
                    {{end}}
                </td>
                <td>{{.LastSeen | formatAgo}}</td>
            </tr>
            {{end}}
        </tbody>
    </table>
    {{else}}
    <div class="empty">
        <p>No devices found.</p>
        {{if .Search}}<p>Try adjusting your search terms.</p>{{end}}
    </div>
    {{end}}
    
    {{if gt .TotalPages 1}}
    <div class="pagination">
        Page {{.Page}} of {{.TotalPages}}
        {{if .HasPrevious}}<a href="?page={{sub .Page 1}}{{if .Search}}&search={{.Search}}{{end}}{{if .Status}}&status={{.Status}}{{end}}">← Previous</a>{{end}}
        {{if .HasNext}}<a href="?page={{add .Page 1}}{{if .Search}}&search={{.Search}}{{end}}{{if .Status}}&status={{.Status}}{{end}}">Next →</a>{{end}}
    </div>
    {{end}}
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            const table = document.querySelector('table');
            
            if (searchInput && table) {
                const tbody = table.querySelector('tbody');
                const rows = tbody ? Array.from(tbody.querySelectorAll('tr')) : [];
                
                searchInput.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    
                    rows.forEach(row => {
                        const hostname = row.cells[0] ? row.cells[0].textContent.toLowerCase() : '';
                        const user = row.cells[1] ? row.cells[1].textContent.toLowerCase() : '';
                        
                        if (hostname.includes(searchTerm) || user.includes(searchTerm)) {
                            row.style.display = '';
                        } else {
                            row.style.display = 'none';
                        }
                    });
                    
                    // Update visible count
                    const visibleRows = rows.filter(row => row.style.display !== 'none');
                    updateEmptyState(visibleRows.length === 0, searchTerm !== '');
                });
                
                // Function to show/hide empty state
                function updateEmptyState(isEmpty, hasSearch) {
                    let emptyState = document.querySelector('.empty');
                    
                    if (isEmpty) {
                        if (!emptyState) {
                            emptyState = document.createElement('div');
                            emptyState.className = 'empty';
                            emptyState.innerHTML = '<p>No devices found.</p>' + 
                                (hasSearch ? '<p>Try adjusting your search terms.</p>' : '');
                            table.parentNode.insertBefore(emptyState, table.nextSibling);
                        } else {
                            emptyState.innerHTML = '<p>No devices found.</p>' + 
                                (hasSearch ? '<p>Try adjusting your search terms.</p>' : '');
                        }
                        table.style.display = 'none';
                    } else {
                        if (emptyState) {
                            emptyState.style.display = 'none';
                        }
                        table.style.display = '';
                    }
                }
            }
        });
    </script>
</body>
</html>