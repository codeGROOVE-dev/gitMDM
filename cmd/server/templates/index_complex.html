<!DOCTYPE html>
<html>
<head>
    <title>Security Compliance Dashboard</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            font-size: 16px; 
            line-height: 1.6;
            margin: 0;
            padding: 40px; 
            color: #2c3e50;
            background: #f8f9fa;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 32px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 32px;
        }
        
        h1 { 
            font-size: 36px; 
            font-weight: 700;
            margin: 0 0 12px 0; 
            color: #2c3e50;
        }
        
        .description {
            color: #6c757d;
            font-size: 18px;
            margin-bottom: 16px;
            line-height: 1.5;
        }
        
        .summary {
            display: flex;
            gap: 24px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 16px 20px;
            border-radius: 8px;
            border-left: 4px solid #dee2e6;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: 700;
            color: #2c3e50;
        }
        
        .stat-label {
            font-size: 14px;
            color: #6c757d;
            margin-top: 4px;
        }
        
        .pagination {
            background: white;
            padding: 20px 32px;
            border-radius: 12px;
            margin-bottom: 32px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .pagination-text {
            color: #6c757d;
            font-size: 16px;
            margin-bottom: 12px;
        }
        
        .pagination-links a {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 500;
            margin-right: 12px;
            display: inline-block;
        }
        
        .pagination-links a:hover {
            background: #0056b3;
        }
        
        .devices-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .devices-header {
            background: #f8f9fa;
            padding: 24px 32px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .devices-title {
            font-size: 24px;
            font-weight: 600;
            color: #2c3e50;
            margin: 0 0 8px 0;
        }
        
        .devices-subtitle {
            color: #6c757d;
            font-size: 16px;
        }
        
        .device-list {
            padding: 0;
        }
        
        .device-item {
            padding: 32px;
            border-bottom: 1px solid #f1f3f4;
            transition: background-color 0.2s ease;
        }
        
        .device-item:hover {
            background: #f8f9fa;
        }
        
        .device-item:last-child {
            border-bottom: none;
        }
        
        .device-main {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }
        
        .device-info h3 {
            font-size: 22px;
            font-weight: 600;
            margin: 0 0 8px 0;
        }
        
        .device-info a {
            color: #007bff;
            text-decoration: none;
        }
        
        .device-info a:hover {
            text-decoration: underline;
        }
        
        .device-meta {
            color: #6c757d;
            font-size: 16px;
            margin-bottom: 4px;
        }
        
        .compliance-badge {
            text-align: right;
        }
        
        .compliance-score {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 4px;
            display: block;
        }
        
        .compliance-label {
            font-size: 14px;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }
        
        .status-excellent {
            color: #28a745;
        }
        
        .status-good {
            color: #ffc107;
        }
        
        .status-needs-attention {
            color: #dc3545;
        }
        
        .status-checking {
            color: #6c757d;
        }
        
        .device-details {
            display: flex;
            gap: 32px;
            color: #6c757d;
            font-size: 14px;
        }
        
        .detail-item {
            display: flex;
            flex-direction: column;
        }
        
        .detail-label {
            font-weight: 600;
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 12px;
        }
        
        .detail-value {
            font-size: 16px;
            color: #2c3e50;
        }
        
        .empty-state {
            text-align: center;
            padding: 80px 32px;
            color: #6c757d;
        }
        
        .empty-state h3 {
            font-size: 24px;
            margin-bottom: 12px;
        }
        
        .empty-state p {
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Security Compliance Dashboard</h1>
        <p class="description">
            This dashboard shows the security compliance status of all monitored devices. 
            Each device is regularly checked against security policies and the compliance percentage indicates how many security requirements are currently met.
        </p>
        <div class="summary">
            <div class="stat-card">
                <div class="stat-number">{{len .Devices}}</div>
                <div class="stat-label">Device{{if ne (len .Devices) 1}}s{{end}} Monitored</div>
            </div>
            {{if .Devices}}
            {{$totalDevices := len .Devices}}
            {{$excellentCount := 0}}
            {{$goodCount := 0}}
            {{$needsAttentionCount := 0}}
            {{range .Devices}}
                {{if .ComplianceScore}}
                    {{if ge .ComplianceScore 0.9}}
                        {{$excellentCount = add $excellentCount 1}}
                    {{else if ge .ComplianceScore 0.7}}
                        {{$goodCount = add $goodCount 1}}
                    {{else}}
                        {{$needsAttentionCount = add $needsAttentionCount 1}}
                    {{end}}
                {{else}}
                    {{$needsAttentionCount = add $needsAttentionCount 1}}
                {{end}}
            {{end}}
            <div class="stat-card">
                <div class="stat-number status-excellent">{{$excellentCount}}</div>
                <div class="stat-label">Excellent (90%+)</div>
            </div>
            <div class="stat-card">
                <div class="stat-number status-good">{{$goodCount}}</div>
                <div class="stat-label">Good (70-89%)</div>
            </div>
            <div class="stat-card">
                <div class="stat-number status-needs-attention">{{$needsAttentionCount}}</div>
                <div class="stat-label">Needs Attention</div>
            </div>
            {{end}}
        </div>
    </div>
    
    {{if gt .TotalPages 1}}
    <div class="pagination">
        <div class="pagination-text">
            Showing page {{.Page}} of {{.TotalPages}} — {{.Total}} total devices
        </div>
        <div class="pagination-links">
            {{if .HasPrevious}}<a href="?page={{sub .Page 1}}">← Previous Page</a>{{end}}
            {{if .HasNext}}<a href="?page={{add .Page 1}}">Next Page →</a>{{end}}
        </div>
    </div>
    {{end}}
    
    <div class="devices-container">
        <div class="devices-header">
            <h2 class="devices-title">Device Details</h2>
            <p class="devices-subtitle">Click on any device name to view detailed security check results</p>
        </div>
        
        <div class="device-list">
            {{range .Devices}}
            <div class="device-item">
                <div class="device-main">
                    <div class="device-info">
                        <h3><a href="/device/{{.HardwareID}}">{{.Hostname}}</a></h3>
                        <div class="device-meta">Primary User: {{.User}}</div>
                        <div class="device-meta">Operating System: {{.OS}} {{.Version}}</div>
                    </div>
                    <div class="compliance-badge">
                        <span class="compliance-score {{if .ComplianceScore}}{{if ge .ComplianceScore 0.9}}status-excellent{{else if ge .ComplianceScore 0.7}}status-good{{else}}status-needs-attention{{end}}{{else}}status-checking{{end}}">
                            {{if .ComplianceScore}}{{printf "%.0f" (mulf .ComplianceScore 100.0)}}%{{else}}—{{end}}
                        </span>
                        <div class="compliance-label">
                            {{if .ComplianceScore}}
                                {{if ge .ComplianceScore 0.9}}Excellent{{else if ge .ComplianceScore 0.7}}Good{{else}}Needs Attention{{end}}
                            {{else}}
                                No Data
                            {{end}}
                        </div>
                    </div>
                </div>
                <div class="device-details">
                    <div class="detail-item">
                        <div class="detail-label">Last Check-in</div>
                        <div class="detail-value">{{.LastSeen | formatAgo}}</div>
                    </div>
                    {{if .ComplianceScore}}
                    <div class="detail-item">
                        <div class="detail-label">Security Status</div>
                        <div class="detail-value">
                            {{if ge .ComplianceScore 0.9}}
                                All security requirements met
                            {{else if ge .ComplianceScore 0.7}}
                                Most security requirements met
                            {{else}}
                                Multiple security issues found
                            {{end}}
                        </div>
                    </div>
                    {{end}}
                </div>
            </div>
            {{else}}
            <div class="empty-state">
                <h3>No Devices Found</h3>
                <p>Devices will appear here once they begin reporting their security status.</p>
            </div>
            {{end}}
        </div>
    </div>

    <div style="margin-top: 48px; padding-top: 24px; border-top: 1px solid #dee2e6; text-align: center;">
        <a href="https://github.com/codeGROOVE-dev/gitMDM" target="_blank" style="color: #6c757d; text-decoration: none; font-size: 14px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="vertical-align: middle; margin-right: 4px;">
                <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
            </svg>
            Powered by gitMDM
        </a>
    </div>
</body>
</html>